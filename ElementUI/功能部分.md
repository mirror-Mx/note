## 下拉框

#### 动态下拉搜索框

```vue
<el-form-item :label="translationData.procedureStr + '：'">
    <el-autocomplete
                     v-model="searchFrom.procedureStr"
                     style="width:100%"
                     size="small"
                     value-key="name"
                     value="id"
                     :fetch-suggestions="querySearchAsync"
                     placeholder="请输入内容"
                     @select="handleSelect"
                     />
</el-form-item>

<script>
export default {
  data() {
    return {
      state: '',
      restaurants: [],
      timeout: null,
      translationData: translation, // 翻译文件数据
      searchFrom: {},
      procedureStr: [],
      loading: false
    }
  },
  mounted() {
    this.procedureStrSearch()
  },
  methods: {
    querySearchAsync(queryString, cb) {
      var restaurants = this.procedureStr
      var results = queryString
        ? restaurants.filter(this.createStateFilter(queryString))
        : restaurants
      cb(results)
    },
    createStateFilter(queryString) {
      return (state) => {
        console.log(state)
        return (
          state.name.toLowerCase().indexOf(queryString.toLowerCase()) === 0
        )
      }
    },
    procedureStrSearch() {
      processDefinition({ pageNum: 1, pageSize: 100 }).then((res) => {
        this.procedureStr = res.data.list
        console.log(this.procedureStr)
      })
    }
  }
}
</script>
```

#### 无法选中的问题

在无法选中的下拉框中添加`this.$forceUpdate()`，强制重新render

![image-20210126145407157](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210126145407157.png)

![image-20210126145434839](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210126145434839.png)

#### 联动下拉框，选中值改变延迟

问题：如下图，三级联动下拉框（一号 二号 三号），当一二三号都已选中值后，一重新选择，二三号下拉框选中值清空，重选，二号下拉框重选延迟，三号下拉框重选后，要在别的输入框选择数据后并且失去焦点，三号下拉框选中值才会出现。

![image-20210309140856216](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210309140856216.png)

原因：由于下拉框在清除数据的时候，使用的上面这种方法就会影响之后数据的改变，改成下面这种就没有问题啦。

```javascript
this.addFrom.deviceId = '',     // 视图没有更新
this.$set(this.addFrom, 'deviceId', '')   //视图更新
```

## 复选框

#### 点击某一行数据需要选中复选框

![image-20210207135029499](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210207135029499.png)

**出现问题：点击后无法改变`checkbox`状态**

原因1：由于`checkbox`状态都是由数据列表渲染而成的，所以，`checkbox`无法改变数据、

```javascript
// 错误写法
this.$set(this.producePlanUnUse[i], 'checkbox', true)
// 正确写法
this.$set(this.producePlanUnUse, i, itemData)
```

原因2：由于`checkbox`双向绑定，只用了赋初始值的`checked`状态，导致数据修改了无效

需要用`v-model`进行双向数据绑定。

出现问题：点击`checkbox`会改变两次选中状态，相当于状态没有改变

原因：点击复选框本身会触发绑定值的改变，加上复选框的父元素有一个点击事件会触发

解决方法：不让复选框的点击事件触发即可

```vue
<div v-for="(item, i) in producePlanUnUse" :key="i" class="row" @click="producePlanClick(item, i)">
    <div v-for="(e,l) in item.list" :key="l" class="item">{{ e.name }}：{{ e.value }}</div>
    <el-checkbox v-model="item.checked" class="item-checkbox" @click.native.prevent />
</div>

<script>
 export default {
   methods: {
    // 点击改变勾选框
    producePlanClick(item, i) {
      const itemData = {
        ...item,
        checked: !item.checked
      }
      this.$set(this.producePlanUnUse, i, itemData)
    },
   }
 }
</script>
```

## 表单

#### 表单验证

- 问题1

  根据element中配置了，提交的时候会发现提示正确，但重新选择后发现提示并未消失

  解决方法：这三处需要统一

  ![image-20210324130731551](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210324130731551.png)

  ![image-20210324130659761](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210324130659761.png)

```javascript
rules: {
    number: [
        { required: true, message: `请输入${translation.number}`, trigger: 'blur' },
        { pattern: /^(([1-9])|(1\d)|(2[0-4]))$/, message: `请输入1-24的数字`, trigger: 'blur' }
    ],
        type: [
            { required: true, message: `请选择${translation.type}`, trigger: 'change' }
        ],
            btnText: [
                { required: true, message: `请输入${translation.btnText}`, trigger: 'blur' }
            ]
},
```

- 问题2

  表单清空后，有提示；但是照样可以表单提交，少了下方这个代码

  ![image-20210510181143327](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210510181143327.png)

  ```javascript
  this.$refs.form.validate((valid) => {
    if (valid) {
      ...
    }
  })
  ```

- 问题3

  联动表单，父子孙关系下，修改父数据需要清空子孙选择的数据

  需要使用this.$set方法，不然容易导致数据选择改变了，但是校验还在，提交不了的情况

## 表格

#### 实现表格单选功能

需求：无论什么情况下，表格只能选择一条数据

​			1.行点击或者点击复选框都可以进行切换，只能有一个复选框被勾选

​			2.删除全选框

原本样式：

![image-20210426105713466](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210426105713466.png)

修改后样式：

![image-20210426110310270](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210426110310270.png)

功能实现：

1.行点击或者点击复选框都可以进行切换，只能有一个复选框被勾选

![image-20210426110520217](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210426110520217.png)

![image-20210426110557232](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210426110557232.png)

![image-20210426111908730](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210426111908730.png)

![image-20210426111924146](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210426111924146.png)

```javascript
//  点击表格行
rowClick(row) {
    this.toggleRow(row)
},
// 选择行中的复选框
select(selection, row) {
    this.toggleRow(row)
},
// 切换行选择事件
toggleRow(row) {
    // 注释的代码标识跟该功能没有关系
    // this.$emit('changeNode', row)
    // this.nodeRow = row
    this.$refs.multipleTable.clearSelection() // 清除表格中的所有选择
    this.$refs.multipleTable.toggleRowSelection(row) // 选中当前行
},
```

2.删除全选框

思路：直接全选框给隐藏即可 > 修改样式 > 表头单元样式修改

![image-20210426113254631](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210426113254631.png)

![image-20210426113323402](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210426113323402.png)

![image-20210426113954558](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210426113954558.png)

![image-20210426114023952](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210426114023952.png)

#### 实现表格纵向滚动条自动滚动到底部

需求：当初始进来/表格数据发生改变的时候，滚动条应默认滚动到底下

解决方案：通过改变滚动条的位置来实现

实现效果: 

![img](C:\Users\62624\AppData\Local\Temp\企业微信截图_1620444818543.png)

功能实现：

1.监听数据改变 --> 给滚动条赋值动态高度

![image-20210508113648113](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210508113648113.png)

![image-20210508113503550](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210508113503550.png)

```javascript
// 有效代码
this.$nextTick(() => {
    this.$refs.tableData.bodyWrapper.scrollTop = this.$refs.tableData.bodyWrapper.scrollHeight
})
```

### 获取当前行的index

![image-20210511114527489](C:\Users\62624\AppData\Roaming\Typora\typora-user-images\image-20210511114527489.png)